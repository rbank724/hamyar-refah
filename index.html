<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ø·Ø±Ø­â€ŒÙ‡Ø§ÛŒ ØªØ³Ù‡ÛŒÙ„Ø§ØªÛŒ</title>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: "Vazirmatn", sans-serif; background-color: #f9f9f9; }
    h1, .search-input, .show-all-btn { color: #1f2937; }

    .result-item {
      aspect-ratio: 1 / 1;      /* Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ Ù…Ø±Ø¨Ø¹ â†’ Ø¯Ø§ÛŒØ±Ù‡ */
      border-radius: 50%;        /* Ú©Ø§Ù…Ù„Ø§Ù‹ Ø¯Ø§ÛŒØ±Ù‡ */
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      width: 100%;
      max-width: 150px;          /* Ø­Ø¯Ø§Ú©Ø«Ø± Ø§Ù†Ø¯Ø§Ø²Ù‡ Ú©Ø§Ø±Øª Ø¯Ø± Ø¯Ø³Ú©ØªØ§Ù¾ */
      transition: all 0.3s ease;
      cursor: pointer;
      opacity: 0;
      transform: translateY(10px);
      animation: fadeInUp 0.4s forwards;
    }
    .result-item:hover { transform: translateY(-3px) scale(1.02); box-shadow:0 10px 15px rgba(0,0,0,0.2); }

    @keyframes fadeInUp { to { opacity:1; transform:translateY(0); } }

    .pagination-btn { @apply px-3 py-1 rounded text-white font-medium transition-all duration-300; }
    .pagination-btn:hover { @apply scale-105 shadow-lg; }
    .pagination-active { @apply bg-gradient-to-r from-indigo-500 to-purple-600; }
    .pagination-inactive { @apply bg-gray-300 text-gray-700; }

    .search-wrapper { position: relative; width: 100%; max-width: 28rem; margin-bottom: 0.5rem; }
    .search-clear { position: absolute; left: 0.75rem; top: 50%; transform: translateY(-50%); cursor: pointer; font-size: 1.2rem; color: #9ca3af; }
    .search-input { padding-left: 2rem; }

    .show-all-btn { width:100%; max-width:28rem; margin-top:0.5rem; background:linear-gradient(to right, #4f46e5, #8b5cf6); color:white; font-weight:bold; padding:0.75rem 1rem; border-radius:9999px; text-align:center; cursor:pointer; transition: all 0.3s ease; }
    .show-all-btn:hover { transform: translateY(-2px) scale(1.02); box-shadow:0 10px 15px rgba(0,0,0,0.2); }

    /* Ù„ÛŒØ³Øª Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù…Ø´Ú©ÛŒ Ø¨Ø§ Ø³Ø§ÛŒÙ‡ */
    #categorySelect {
      color: #000; /* Ù…ØªÙ† Ù…Ø´Ú©ÛŒ */
      text-shadow: 0 1px 2px rgba(0,0,0,0.25);
      background-color: #fff; /* Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø³ÙÛŒØ¯ */
      border: 1px solid #ccc;
      border-radius: 9999px; /* Ú¯Ø±Ø¯ Ùˆ Ù†Ø±Ù… */
      padding: 0.75rem 1rem;
      font-weight: bold;
      cursor: pointer;
    }
    #categorySelect option { color: #000; }

    /* Ú¯Ø±ÛŒØ¯ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ùˆ Ù…Ø±Ú©Ø² Ú†ÛŒÙ† */
    #results {
      display: grid;
      justify-content: center;
      gap: 1rem;
      grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
    }
    /* Ù…ÙˆØ¨Ø§ÛŒÙ„: Û³ Ø³ØªÙˆÙ† */
    @media (max-width: 767px) {
      #results { grid-template-columns: repeat(3, minmax(80px, 1fr)); }
    }
    /* Ø¯Ø³Ú©ØªØ§Ù¾: Û´ Ø³ØªÙˆÙ† */
    @media (min-width: 768px) {
      #results { grid-template-columns: repeat(4, minmax(100px, 1fr)); }
    }

    #backToTop { display:none; position:fixed; bottom:20px; left:20px; z-index:9999; background:#4f46e5; color:#fff; border:none; border-radius:50%; width:44px; height:44px; font-size:22px; cursor:pointer; box-shadow:0 2px 6px rgba(0,0,0,0.3); }

    #detail, #detail * { text-align: justify !important; }
    #detail-content * { color:inherit; }

    #detail-controls { display:flex; gap:8px; margin-bottom:6px; justify-start; }
  </style>
</head>
<body class="flex flex-col items-center m-0 p-4">

  <h1 class="mb-4 font-medium text-xl sm:text-2xl text-center">Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ø·Ø±Ø­â€ŒÙ‡Ø§ÛŒ ØªØ³Ù‡ÛŒÙ„Ø§ØªÛŒ</h1>

  <div class="search-wrapper">
    <span class="search-clear" onclick="clearSearch()">ğŸ§¹</span>
    <input id="search-box" type="text" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ú©Ù†ÛŒØ¯..." 
      class="search-input w-full px-4 py-3 text-base sm:text-lg border border-gray-300 rounded-full outline-none shadow-md"/>
  </div>

  <!-- Ù…Ù†ÙˆÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ -->
  <select id="categorySelect" class="show-all-btn">
    <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ...</option>
  </select>

  <div id="results" class="mt-4 w-full max-w-3xl gap-4"></div>
  <div id="pagination" class="mt-4 flex gap-2 flex-wrap justify-center"></div>
  <div id="loading" class="hidden mt-4 text-gray-600 text-sm sm:text-base">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>

  <div id="detail-controls" class="flex gap-2 mb-4 hidden">
    <button id="font-plus" title="Ø¨Ø²Ø±Ú¯ØªØ±" style="background:#4f46e5;color:#fff;border:none;border-radius:50%;width:36px;height:36px;cursor:pointer;font-weight:bold;">A+</button>
    <button id="share-btn" title="Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ" style="background:#4f46e5;color:#fff;border:none;border-radius:50%;width:36px;height:36px;cursor:pointer;font-size:18px;">ğŸ“¤</button>
    <button id="font-minus" title="Ú©ÙˆÚ†Ú©ØªØ±" style="background:#4f46e5;color:#fff;border:none;border-radius:50%;width:36px;height:36px;cursor:pointer;font-weight:bold;">A-</button>
  </div>

  <div id="detail" class="mt-8 w-full max-w-3xl p-5 rounded-xl bg-white shadow-md hidden leading-8 text-sm sm:text-base"></div>

  <button id="backToTop" title="Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¨Ø§Ù„Ø§">â†‘</button>

  <script>
    let data = [], fuse, filteredResults = [], showAll = false, currentPage = 1;
    const perPage = 10, fileCache = new Map();

    let categories = new Set();

    fetch("data.json").then(res => res.json()).then(json => { 
      data = json; 
      fuse = new Fuse(data, { keys:["title","keywords"], threshold:0.3 });
      json.forEach(item => categories.add(item.category));
      const catSelect = document.getElementById("categorySelect");
      categories.forEach(cat => {
        const opt = document.createElement("option");
        opt.value = cat;
        opt.textContent = cat;
        catSelect.appendChild(opt);
      });
    });

    const searchBox = document.getElementById("search-box");
    const resultsDiv = document.getElementById("results");
    const detailDiv = document.getElementById("detail");
    const loading = document.getElementById("loading");
    const paginationDiv = document.getElementById("pagination");
    const controls = document.getElementById("detail-controls");

    window.addEventListener("DOMContentLoaded", () => { controls.style.display = "none"; });

    function renderPage(page){
      resultsDiv.innerHTML = ""; paginationDiv.innerHTML = ""; hideDetail();
      if(filteredResults.length===0){ resultsDiv.style.display="none"; return; } else { resultsDiv.style.display="grid"; }

      if(filteredResults.length===1){
        resultsDiv.style.gridTemplateColumns="repeat(1,1fr)";
      } else {
        resultsDiv.style.gridTemplateColumns=window.innerWidth>=768?"repeat(4, minmax(100px,1fr))":"repeat(3, minmax(80px,1fr))";
      }

      const start = (page-1)*perPage;
      const pageItems = filteredResults.slice(start,start+perPage);
      pageItems.forEach(r=>{
        const item = r.item||r;
        const div = document.createElement("div");
        div.className="result-item p-4 bg-green-500 text-white shadow-md text-sm sm:text-base";
        div.innerHTML=`<strong>${item.title}</strong>`;
        div.onclick = () => {
          resultsDiv.style.display="none"; loading.style.display="block";
          if(fileCache.has(item.file)){ showDetail(item, fileCache.get(item.file)); }
          else { fetch(item.file).then(res=>res.text()).then(html=>{ fileCache.set(item.file,html); showDetail(item,html); }); }
        };
        resultsDiv.appendChild(div);
      });

      const totalPages = Math.ceil(filteredResults.length/perPage);
      if(totalPages>1){
        for(let i=1;i<=totalPages;i++){
          const btn = document.createElement("button");
          btn.textContent=i;
          btn.className="pagination-btn "+(i===page?"pagination-active":"pagination-inactive");
          btn.onclick=()=>{currentPage=i; renderPage(i);}
          paginationDiv.appendChild(btn);
        }
      }
    }

    function showDetail(item, html){
      loading.style.display = "none";
      detailDiv.innerHTML = html;
      detailDiv.style.display = "block";
      detailDiv.scrollIntoView({behavior:"smooth"});
      controls.style.display = "flex";
      const share = document.getElementById("share-btn");
      share.onclick = () => {
        const contentText = detailDiv.innerText;
        const textToShare = item.title + "\n\n" + contentText;
        if(navigator.share){ navigator.share({ title:item.title, text:textToShare }); }
        else { navigator.clipboard.writeText(textToShare).then(()=>{ alert("Ù…ØªÙ† Ø·Ø±Ø­ Ùˆ Ø¹Ù†ÙˆØ§Ù† Ø¢Ù† Ú©Ù¾ÛŒ Ø´Ø¯."); }); }
      };
      const plus = document.getElementById("font-plus");
      const minus = document.getElementById("font-minus");
      let fontSize = 16;
      plus.onclick = () => { fontSize +=2; detailDiv.style.fontSize = fontSize+"px"; detailDiv.style.lineHeight="1.8"; };
      minus.onclick = () => { if(fontSize>10){ fontSize-=2; detailDiv.style.fontSize=fontSize+"px"; detailDiv.style.lineHeight="1.8"; } };
    }

    function hideDetail(){ detailDiv.style.display="none"; controls.style.display="none"; }

    function doSearch(){
      const query = searchBox.value.trim();
      filteredResults = (query.length>1 && fuse)? fuse.search(query) : [];
      currentPage=1; renderPage(currentPage);
    }

    function clearSearch(){ searchBox.value=""; filteredResults=[]; renderPage(1); }

    document.getElementById("categorySelect").addEventListener("change", e=>{
      const cat = e.target.value;
      if(cat===""){ filteredResults=[]; renderPage(1); return; }
      filteredResults = data.filter(d=>d.category===cat).map(d=>({item:d}));
      currentPage=1;
      renderPage(currentPage);
    });

    searchBox.addEventListener("input", doSearch);

    const backToTop=document.getElementById("backToTop");
    window.addEventListener("scroll",()=>{ backToTop.style.display=(window.scrollY>200)?"block":"none"; });
    backToTop.onclick=()=>window.scrollTo({top:0,behavior:"smooth"});

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').then(reg => {
        reg.onupdatefound = () => {
          const newWorker = reg.installing;
          newWorker.onstatechange = () => {
            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
              const bar = document.createElement('div');
              bar.textContent = 'Ù†Ø³Ø®Ù‡â€ŒÛŒ Ø¬Ø¯ÛŒØ¯ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³ØªØ› Ø¨Ø±Ø§ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø²Ù†ÛŒØ¯';
              Object.assign(bar.style, {
                position: 'fixed', bottom: '0', left: '0', right: '0',
                background: '#007BFF', color: '#fff', textAlign: 'center',
                padding: '10px', fontFamily: 'inherit', cursor: 'pointer', zIndex: 9999
              });
              bar.onclick = () => location.reload();
              document.body.appendChild(bar);
            }
          };
        };
      });
    }
  </script>
</body>
</html>
